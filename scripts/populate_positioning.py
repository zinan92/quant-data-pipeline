"""
为所有自选股填充 positioning（一句话定位）
每只股票用2-8个中文字概括公司在赛道中的具体角色/定位
"""

import sqlite3
import os

DB_PATH = os.path.join(os.path.dirname(__file__), "..", "data", "market.db")

# ticker -> positioning 映射
# 格式：简洁、专业、有信息量，2-8个中文字
POSITIONING_DATA = {
    # ===== AI应用 (46) =====
    "000555": "金融IT",
    "000676": "AI营销",
    "002131": "数字营销",
    "002153": "酒旅IT",
    "002177": "金融设备",
    "002195": "产业互联",
    "002230": "语音AI龙头",
    "002355": "车联网",
    "002410": "建筑信息化龙头",
    "002416": "AI分发",
    "002657": "金融科技",
    "002841": "智能交互平板",
    "002908": "民生IT",
    "002987": "金融IT外包",
    "300010": "AI教育",
    "300058": "AI营销龙头",
    "300065": "海洋信息化",
    "300085": "金融IT",
    "300170": "企业信息化",
    "300296": "LED显示龙头",
    "300348": "银行核心系统",
    "300378": "制造业ERP",
    "300451": "医疗IT",
    "300546": "智能证照",
    "300634": "企业邮件+云",
    "300766": "数据智能",
    "300785": "AI导购",
    "300925": "IT服务",
    "301171": "出海营销",
    "301236": "IT外包龙头",
    "301316": "IT服务",
    "301638": "电力数字化",
    "600131": "电力信息化",
    "600570": "金融IT龙头",
    "600588": "企业ERP龙头",
    "600699": "智能座舱",
    "601360": "安全+AI",
    "603025": "工业智能控制",
    "603232": "信息安全",
    "603859": "工业数字化",
    "688088": "视觉AI",
    "688095": "PDF软件",
    "688111": "办公AI龙头",
    "688229": "IT运维监控",
    "688318": "金融终端",
    "688369": "协同办公",

    # ===== PCB (10) =====
    "002463": "高端PCB",
    "300456": "MEMS芯片",
    "300476": "HDI板",
    "300682": "能源互联网",
    "300739": "高频PCB",
    "300814": "通信PCB",
    "301377": "PCB微钻",
    "600183": "覆铜板龙头",
    "603228": "柔性PCB",
    "603920": "汽车PCB",

    # ===== 传媒游戏 (13) =====
    "000917": "传媒平台",
    "002181": "区域传媒",
    "002517": "手游",
    "002555": "游戏龙头",
    "002558": "网游",
    "002602": "游戏+云计算",
    "002624": "端游+影视",
    "300413": "视频平台龙头",
    "300418": "AI+游戏出海",
    "301551": "移动传媒",
    "600637": "综合传媒",
    "600977": "院线龙头",
    "601929": "广电网络",

    # ===== 储能锂电 (24) =====
    "002036": "光学+触控",
    "002192": "锂矿",
    "002240": "锂盐",
    "002340": "电池回收龙头",
    "002460": "锂矿+锂盐龙头",
    "002466": "锂矿龙头",
    "002738": "铯铷+锂矿",
    "002756": "碳酸锂",
    "002850": "电池结构件龙头",
    "002976": "新能源零部件",
    "002978": "钒钛矿",
    "300007": "传感器+储能",
    "300337": "铝基复合材料",
    "300373": "功率半导体",
    "300457": "锂电设备",
    "300539": "新能源精密件",
    "300618": "钴粉龙头",
    "301013": "锂电检测",
    "301219": "钴铜",
    "301488": "新能源连接器",
    "600711": "钴镍矿",
    "600869": "电缆+储能",
    "603799": "钴+前驱体龙头",
    "688772": "消费电池",

    # ===== 光伏 (20) =====
    "002056": "磁材+光伏电池",
    "002129": "硅片龙头",
    "002459": "组件龙头",
    "002865": "TOPCon电池",
    "003022": "光伏胶膜材料",
    "300274": "逆变器龙头",
    "300316": "长晶设备龙头",
    "300724": "电池片设备",
    "300751": "HJT设备",
    "300763": "组串逆变器",
    "600438": "硅料+电池龙头",
    "600732": "ABC电池",
    "601012": "光伏龙头",
    "601865": "光伏玻璃龙头",
    "603806": "光伏胶膜龙头",
    "605117": "微型逆变器",
    "688223": "组件龙头",
    "688303": "硅料",
    "688472": "组件+储能",
    "688599": "组件+跟踪支架",

    # ===== 其他 (12) =====
    "000582": "港口物流",
    "001238": "家居用品",
    "300674": "银行IT",
    "301076": "特种化工材料",
    "301188": "药用玻璃",
    "301590": "充电桩电源",
    "600410": "IT集成",
    "600529": "药用玻璃龙头",
    "605136": "美妆代运营",
    "688377": "油气装备",
    "688727": "光刻胶",
    "920068": "钛合金",

    # ===== 军工 (47) =====
    "000547": "电子对抗",
    "000561": "军用通信",
    "000738": "航发控制系统",
    "000969": "特种金属材料",
    "002017": "智能卡",
    "002278": "石油装备",
    "002342": "索具+吊装",
    "002465": "北斗通信",
    "002565": "新材料",
    "002583": "专网通信",
    "002625": "超材料隐身",
    "002735": "军品包装",
    "003009": "火箭弹",
    "300136": "射频天线",
    "300177": "卫星导航",
    "300285": "MLCC+陶瓷",
    "300455": "军工电子",
    "300887": "军工检测",
    "301005": "精密零部件",
    "301079": "液压件",
    "301396": "飞控系统",
    "301522": "高温合金",
    "600072": "船舶设计",
    "600143": "改性塑料龙头",
    "600184": "光电瞄具",
    "600343": "液体火箭发动机",
    "600482": "舰船动力",
    "600498": "光通信",
    "600522": "光纤光缆龙头",
    "600775": "军工电子",
    "600776": "通信设备",
    "600879": "航天电子",
    "600990": "雷达",
    "601698": "卫星运营",
    "603308": "核电铸件",
    "603809": "同步器齿环",
    "688102": "铜合金材料",
    "688122": "钛合金+超导",
    "688239": "航空锻件",
    "688270": "军用射频芯片",
    "688281": "隐身材料",
    "688333": "金属3D打印",
    "688523": "航天复合材料",
    "688539": "军用传感器",
    "688568": "数字地球",
    "688592": "北斗高精度",
    "688722": "芳纶材料",

    # ===== 创新药 (27) =====
    "000516": "医疗服务",
    "000661": "生长激素龙头",
    "000710": "基因检测",
    "002044": "体检连锁龙头",
    "002172": "医疗服务",
    "002173": "综合医疗",
    "002219": "医院管理",
    "300244": "第三方诊断",
    "300253": "医疗IT",
    "300404": "CRO",
    "300676": "基因测序龙头",
    "300725": "分子砌块",
    "300759": "CXO龙头",
    "301060": "第三方检测",
    "301230": "CDMO",
    "301257": "临床CRO",
    "301333": "临床CRO",
    "301509": "多肽CDMO",
    "301520": "一致性评价",
    "600196": "综合药企龙头",
    "600513": "化学制药",
    "603259": "CXO龙头",
    "603334": "生物活性酯",
    "688073": "分子砌块",
    "688202": "临床前CRO",
    "688222": "DNA编码库",
    "920670": "数字医疗",

    # ===== 半导体 (43) =====
    "000021": "半导体封装",
    "000066": "安全计算",
    "000859": "BOPET薄膜",
    "001309": "存储芯片",
    "002049": "安全芯片龙头",
    "002156": "封测龙头",
    "002185": "封测",
    "002290": "复合材料",
    "002371": "半导体设备龙头",
    "002407": "电子级氢氟酸",
    "002409": "半导体材料",
    "002436": "IC载板",
    "002549": "电子气体",
    "002916": "IC载板+PCB",
    "300054": "CMP抛光材料",
    "300236": "半导体化学品",
    "300260": "洁净管阀",
    "300346": "ArF光刻胶",
    "300655": "湿电子化学品",
    "301308": "存储模组龙头",
    "601858": "科技出版",
    "603256": "电子布",
    "603650": "光刻胶+树脂",
    "603690": "高纯工艺系统",
    "603948": "半导体化学品",
    "603986": "存储+MCU龙头",
    "605589": "电子树脂",
    "688012": "刻蚀设备龙头",
    "688018": "WiFi MCU",
    "688019": "CMP材料",
    "688037": "涂胶显影设备",
    "688041": "国产CPU",
    "688047": "国产CPU",
    "688072": "薄膜沉积设备",
    "688082": "清洗设备龙头",
    "688110": "存储芯片",
    "688135": "芯片测试",
    "688181": "液晶材料",
    "688332": "蓝牙芯片",
    "688396": "IDM龙头",
    "688521": "IP授权",
    "688525": "嵌入式存储",
    "688720": "电镀液",

    # ===== 发电 (19) =====
    "000825": "不锈钢龙头",
    "001332": "电力安装",
    "002276": "电缆+充电桩",
    "300046": "功率半导体",
    "300129": "风电塔筒",
    "300963": "特种合金",
    "600089": "变压器龙头",
    "600406": "电力自动化龙头",
    "600477": "钢结构",
    "600517": "电力金融",
    "601179": "输变电设备",
    "601669": "电力建设龙头",
    "601727": "电力装备",
    "601868": "能源建设",
    "601869": "光纤龙头",
    "603169": "核+氢能装备",
    "603916": "混凝土外加剂",
    "688186": "风电铸件",
    "688187": "IGBT+轨交",

    # ===== 可控核聚变 (10) =====
    "002318": "特种钢管龙头",
    "002366": "核电装备",
    "002639": "压缩机+氢能",
    "300471": "氢能加注",
    "600105": "超导电缆",
    "600468": "超导限流器",
    "600875": "发电设备龙头",
    "601985": "核电运营龙头",
    "603011": "液压机",
    "688776": "真空设备",

    # ===== 机器人 (38) =====
    "000887": "密封件",
    "000981": "汽车零部件",
    "001306": "精密齿轮",
    "002008": "激光设备龙头",
    "002031": "轮胎模具+机器人",
    "002048": "汽车内外饰",
    "002050": "热管理龙头",
    "002241": "声学+XR",
    "002681": "智能终端",
    "002837": "精密温控",
    "003021": "微型驱动",
    "300077": "MCU芯片",
    "300124": "伺服驱动龙头",
    "300258": "锻造齿轮",
    "300403": "排水泵+微电机",
    "300421": "精密钢球",
    "300432": "精密零部件",
    "300450": "锂电设备龙头",
    "300585": "电子油门",
    "300660": "微特电机",
    "300879": "园林机械",
    "300964": "FPC",
    "301007": "微电机轴",
    "301029": "自动化标准件",
    "301368": "精密齿轮箱",
    "301550": "微特电机",
    "301596": "精密传动",
    "603009": "转向零部件",
    "603119": "电机绝缘",
    "603166": "触点材料",
    "603219": "按摩椅",
    "603275": "变频器",
    "603486": "扫地机器人龙头",
    "603667": "轴承+丝杠",
    "688017": "谐波减速器龙头",
    "688188": "激光切割控制",
    "688556": "金刚线切割",
    "688678": "精密弹簧",

    # ===== 消费 (2) =====
    "301078": "母婴零售",
    "601888": "免税龙头",

    # ===== 白酒 (4) =====
    "000568": "浓香白酒",
    "000858": "浓香龙头",
    "600519": "酱香龙头",
    "600809": "清香龙头",

    # ===== 算力/AI基建 (10) =====
    "000034": "IT分销+云",
    "300454": "网络安全龙头",
    "300496": "智能OS",
    "300502": "光模块",
    "300638": "物联网模组",
    "300698": "数据中心配套",
    "688036": "非洲手机龙头",
    "688168": "网络安全可视化",
    "688225": "电信安全",
    "688435": "数据容灾",

    # ===== 脑机接口 (10) =====
    "002414": "红外芯片龙头",
    "300430": "制药设备",
    "300678": "智能识别",
    "300753": "镇痛设备",
    "301293": "脑科专科医院",
    "301363": "导管+穿刺器",
    "688351": "电生理",
    "688580": "康复设备",
    "688626": "康复器械",
    "688709": "特种集成电路",

    # ===== 贵金属 (12) =====
    "000506": "黄金采冶",
    "000975": "黄金+铜矿",
    "001337": "黄金采冶",
    "002155": "黄金+锑",
    "002237": "黄金冶炼",
    "002716": "白银",
    "300139": "海外金矿",
    "600489": "黄金龙头",
    "600547": "黄金龙头",
    "600988": "黄金采冶",
    "601069": "黄金采冶",
    "601899": "金铜矿龙头",

    # ===== 金属 (48) =====
    "000060": "铅锌",
    "000426": "锡",
    "000630": "铜冶炼",
    "000657": "硬质合金",
    "000688": "铅锌矿",
    "000737": "铜矿",
    "000762": "盐湖锂+铬",
    "000807": "电解铝",
    "000831": "稀土加工",
    "000878": "铜冶炼",
    "000933": "电解铝+煤",
    "000960": "锡龙头",
    "000962": "钽铌",
    "002149": "稀有金属加工",
    "002167": "锆",
    "002182": "镁",
    "002378": "钨",
    "002379": "电解铝龙头",
    "002428": "锗",
    "002532": "电解铝",
    "002842": "钨",
    "002867": "黄金珠宝",
    "300328": "液态金属",
    "300748": "稀土永磁龙头",
    "301026": "贵金属回收",
    "600111": "稀土龙头",
    "600219": "铝加工龙头",
    "600259": "稀土分离",
    "600281": "气体+新材料",
    "600301": "锡锌",
    "600362": "铜龙头",
    "600392": "稀土冶炼",
    "600456": "钛龙头",
    "600459": "铂族金属",
    "600497": "锌锗",
    "600549": "钨+稀土",
    "600595": "电解铝",
    "601061": "金属贸易",
    "601168": "铜铅锌矿",
    "601212": "铜铅锌冶炼",
    "601600": "电解铝龙头",
    "601958": "钼龙头",
    "603398": "新能源材料",
    "603979": "矿山服务龙头",
    "603993": "钼铜钴",
    "605376": "金属粉体",
    "688750": "钛材",
    "920914": "精密金属件",

    # ===== 金融 (10) =====
    "300059": "互联网券商龙头",
    "600030": "券商龙头",
    "600036": "零售银行龙头",
    "601128": "小微银行",
    "601318": "综合金融龙头",
    "601319": "财险龙头",
    "601398": "大行龙头",
    "601628": "寿险龙头",
    "601838": "城商行",
    "601995": "投行龙头",
}


def main():
    conn = sqlite3.connect(DB_PATH)
    cursor = conn.cursor()

    # 获取所有现有的 ticker
    cursor.execute("SELECT ticker FROM stock_sectors")
    existing_tickers = {row[0] for row in cursor.fetchall()}

    updated = 0
    missing = 0

    for ticker, positioning in POSITIONING_DATA.items():
        if ticker in existing_tickers:
            cursor.execute(
                "UPDATE stock_sectors SET positioning = ? WHERE ticker = ?",
                (positioning, ticker),
            )
            updated += 1
        else:
            print(f"  警告: ticker {ticker} 不在 stock_sectors 表中，跳过")
            missing += 1

    # 检查是否有 stock_sectors 中的 ticker 没有被覆盖
    covered = set(POSITIONING_DATA.keys())
    uncovered = existing_tickers - covered
    if uncovered:
        print(f"\n  以下 {len(uncovered)} 只股票未设置 positioning:")
        for t in sorted(uncovered):
            cursor.execute("SELECT sector FROM stock_sectors WHERE ticker = ?", (t,))
            sector = cursor.fetchone()[0]
            print(f"    {t} ({sector})")

    conn.commit()
    conn.close()

    print(f"\n完成: 更新 {updated} 条, 跳过 {missing} 条")
    print(f"覆盖率: {updated}/{len(existing_tickers)} ({updated/len(existing_tickers)*100:.1f}%)")


if __name__ == "__main__":
    main()
