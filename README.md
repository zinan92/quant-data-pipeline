# Aè‚¡æ•°æ®ç›‘æ§ç³»ç»Ÿ

å®æ—¶ç›‘æ§Aè‚¡å¸‚åœºæ•°æ®ï¼ŒåŒ…æ‹¬æŒ‡æ•°ã€æ¦‚å¿µæ¿å—ã€ETFå’Œè‡ªé€‰è‚¡ç¥¨çš„Kçº¿å›¾è¡¨å’Œè¡Œæƒ…ä¿¡æ¯ã€‚

## åŠŸèƒ½ç‰¹æ€§

- âœ… **å®æ—¶æ•°æ®æ›´æ–°**ï¼šMarket On/Offè‡ªåŠ¨åˆ‡æ¢ï¼Œäº¤æ˜“æ—¶é—´å†…å®æ—¶è½®è¯¢
- ğŸ“Š **å¤šç»´åº¦Kçº¿**ï¼šæ”¯æŒæ—¥çº¿ã€30åˆ†é’Ÿçº¿ï¼Œé…ç½®å‡çº¿å‚æ•°
- ğŸ¯ **æ¦‚å¿µæ¿å—ç›‘æ§**ï¼šæ¶¨å¹…Top20ã€è‡ªé€‰æ¦‚å¿µå®æ—¶è¿½è¸ª
- ğŸ” **æ•°æ®ä¸€è‡´æ€§éªŒè¯**ï¼š15:45è‡ªåŠ¨éªŒè¯æ”¶ç›˜åä¸‰ä»·ä¸€è‡´
- âš¡ **æ€§èƒ½ä¼˜åŒ–**ï¼šMarket Offåœæ­¢è½®è¯¢ï¼ŒèŠ‚çœ70% APIè¯·æ±‚

## æŠ€æœ¯æ ˆ

### åç«¯
- FastAPI - é«˜æ€§èƒ½å¼‚æ­¥Webæ¡†æ¶
- AKShare - Aè‚¡æ•°æ®è·å–
- SQLAlchemy - ORMæ•°æ®åº“è®¿é—®
- APScheduler - å®šæ—¶ä»»åŠ¡è°ƒåº¦

### å‰ç«¯
- React + TypeScript
- TanStack Query - æ•°æ®è·å–ä¸ç¼“å­˜
- Lightweight Charts - é«˜æ€§èƒ½Kçº¿å›¾è¡¨
- Vite - æ„å»ºå·¥å…·

## å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

**åç«¯**:
```bash
pip install -r requirements.txt
```

**å‰ç«¯**:
```bash
cd frontend
npm install
```

### 2. å¯åŠ¨æœåŠ¡

**åç«¯** (FastAPI + å®šæ—¶ä»»åŠ¡):
```bash
python -m uvicorn web.app:app --host 0.0.0.0 --port 8000
```

**æ¦‚å¿µç›‘æ§** (ç‹¬ç«‹è¿›ç¨‹):
```bash
nohup python3 scripts/monitor_no_flask.py > logs/monitor.log 2>&1 &
```

**å‰ç«¯å¼€å‘**:
```bash
cd frontend
npm run dev
```

**å‰ç«¯ç”Ÿäº§æ„å»º**:
```bash
cd frontend
npm run build
```

## é¡¹ç›®ç»“æ„

```
a-share-data/
â”œâ”€â”€ src/                      # åç«¯æºç 
â”‚   â”œâ”€â”€ api/                  # APIè·¯ç”±
â”‚   â”‚   â”œâ”€â”€ routes_concepts.py      # æ¦‚å¿µæ¿å—API
â”‚   â”‚   â”œâ”€â”€ routes_index.py         # æŒ‡æ•°API
â”‚   â”‚   â”œâ”€â”€ routes_concept_monitor_v2.py  # æ¦‚å¿µç›‘æ§API
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ services/             # ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ kline_scheduler.py      # å®šæ—¶ä»»åŠ¡è°ƒåº¦
â”‚   â”‚   â”œâ”€â”€ kline_updater.py        # æ•°æ®æ›´æ–°
â”‚   â”‚   â””â”€â”€ data_consistency_validator.py  # æ•°æ®éªŒè¯
â”‚   â”œâ”€â”€ models.py            # æ•°æ®æ¨¡å‹
â”‚   â””â”€â”€ database.py          # æ•°æ®åº“é…ç½®
â”œâ”€â”€ frontend/                # å‰ç«¯æºç 
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/      # Reactç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ IndexChart.tsx      # æŒ‡æ•°å›¾è¡¨
â”‚   â”‚   â”‚   â””â”€â”€ ConceptKlineCard.tsx # æ¦‚å¿µKçº¿å¡ç‰‡
â”‚   â”‚   â”œâ”€â”€ hooks/           # è‡ªå®šä¹‰Hooks
â”‚   â”‚   â”‚   â”œâ”€â”€ useRealtimePrice.ts # å®æ—¶ä»·æ ¼
â”‚   â”‚   â”‚   â””â”€â”€ useConceptMonitor.ts # æ¦‚å¿µç›‘æ§
â”‚   â”‚   â””â”€â”€ utils/           # å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ package.json
â”œâ”€â”€ scripts/                 # è„šæœ¬å·¥å…·
â”‚   â”œâ”€â”€ monitor_no_flask.py  # æ¦‚å¿µç›‘æ§è„šæœ¬
â”‚   â”œâ”€â”€ check_market_status.py  # å¸‚åœºçŠ¶æ€æ£€æŸ¥
â”‚   â””â”€â”€ test_data_consistency.py  # æ•°æ®ä¸€è‡´æ€§æµ‹è¯•
â”œâ”€â”€ docs/                    # æ–‡æ¡£
â”‚   â”œâ”€â”€ final-deployment-summary.md  # éƒ¨ç½²æ€»ç»“
â”‚   â”œâ”€â”€ market-hours-logic.md        # Market On/Offé€»è¾‘
â”‚   â””â”€â”€ data-consistency-fix.md      # æ•°æ®ä¸€è‡´æ€§ä¿®å¤
â””â”€â”€ logs/                    # æ—¥å¿—æ–‡ä»¶

```

## Market On/Off æœºåˆ¶

ç³»ç»Ÿæ ¹æ®äº¤æ˜“æ—¶é—´è‡ªåŠ¨è°ƒæ•´æ•°æ®æ›´æ–°ç­–ç•¥ï¼š

### äº¤æ˜“æ—¶é—´ (UTC+8)
- ä¸Šåˆï¼š09:30 - 11:30
- ä¸‹åˆï¼š13:00 - 15:00

### æ›´æ–°è¡Œä¸º

| æ—¶é—´æ®µ | å®æ—¶æ•°æ® | æ—¥çº¿Kçº¿ | 30åˆ†é’ŸKçº¿ | è¡Œæƒ…è¯¦æƒ… |
|--------|---------|---------|-----------|---------|
| **Market On** | âœ… æ¯30ç§’ | âœ… æ¯30ç§’ | âœ… æ¯5åˆ†é’Ÿ | âœ… æ¯30ç§’ |
| **Market Off** | âŒ åœæ­¢ | âŒ åœæ­¢ | âŒ åœæ­¢ | âŒ åœæ­¢ |

## å®šæ—¶ä»»åŠ¡

| æ—¶é—´ | ä»»åŠ¡ | è¯´æ˜ |
|-----|------|------|
| 09:30-15:00 | 30åˆ†é’ŸKçº¿æ›´æ–° | äº¤æ˜“æ—¶é—´å†…æ¯30åˆ†é’Ÿæ›´æ–° |
| 15:30 | æ—¥çº¿Kçº¿æ›´æ–° | åŒ…å«æŒ‡æ•°å’Œæ¦‚å¿µ |
| 15:45 | æ•°æ®ä¸€è‡´æ€§éªŒè¯ | è‡ªåŠ¨éªŒè¯ä¸‰ä»·ä¸€è‡´ |
| 16:00 | å…¨å¸‚åœºæ—¥çº¿æ›´æ–° | å…¨å¸‚åœºè‚¡ç¥¨æ•°æ® |
| 00:01 | äº¤æ˜“æ—¥å†æ›´æ–° | æ›´æ–°äº¤æ˜“æ—¥å† |

## ç›‘æ§å’Œç»´æŠ¤

### æ£€æŸ¥æœåŠ¡çŠ¶æ€

```bash
# åç«¯æœåŠ¡
ps aux | grep uvicorn

# æ¦‚å¿µç›‘æ§è„šæœ¬
ps aux | grep monitor_no_flask

# æŸ¥çœ‹æ—¥å¿—
tail -f logs/service.log
tail -f logs/monitor.log
```

### æ‰‹åŠ¨éªŒè¯æ•°æ®

```bash
# æ£€æŸ¥å¸‚åœºçŠ¶æ€
python scripts/check_market_status.py

# éªŒè¯æ•°æ®ä¸€è‡´æ€§
python scripts/test_data_consistency.py

# è°ƒç”¨éªŒè¯API
curl -X POST http://localhost:8000/api/admin/validate-data-consistency
```

### é‡å¯æœåŠ¡

**åç«¯**:
```bash
# æŸ¥æ‰¾è¿›ç¨‹ID
ps aux | grep uvicorn | grep -v grep | awk '{print $2}'

# æ€æ‰è¿›ç¨‹
kill <PID>

# é‡å¯
python -m uvicorn web.app:app --host 0.0.0.0 --port 8000
```

**æ¦‚å¿µç›‘æ§**:
```bash
# æ€æ‰è¿›ç¨‹
kill $(ps aux | grep monitor_no_flask | grep -v grep | awk '{print $2}')

# é‡å¯
nohup python3 scripts/monitor_no_flask.py > logs/monitor.log 2>&1 &
```

## éƒ¨ç½²å†å²

è¯¦è§ `docs/final-deployment-summary.md`

### æœ€è¿‘æ›´æ–° (2026-01-20)

1. âœ… ä¿®å¤æŒ‡æ•°æ—¥çº¿æœªæ›´æ–°bugï¼ˆawaitå…³é”®å­—ç¼ºå¤±ï¼‰
2. âœ… å®ç°Market On/Offè‡ªåŠ¨åˆ‡æ¢æœºåˆ¶
3. âœ… åˆ›å»ºæ•°æ®ä¸€è‡´æ€§è‡ªåŠ¨éªŒè¯ç³»ç»Ÿï¼ˆ15:45ï¼‰
4. âœ… ä¿®å¤æ¦‚å¿µç›‘æ§æ•°æ®åœæ­¢æ›´æ–°é—®é¢˜
5. âœ… å‰ç«¯æ‰€æœ‰æŸ¥è¯¢æ·»åŠ å¸‚åœºæ„ŸçŸ¥é€»è¾‘

## å¸¸è§é—®é¢˜

### Q: æ”¶ç›˜åæ•°æ®ä¸ºä»€ä¹ˆä¸æ›´æ–°ï¼Ÿ
A: è¿™æ˜¯é¢„æœŸè¡Œä¸ºã€‚Market Offæ—¶åœæ­¢æ‰€æœ‰è½®è¯¢ï¼ŒèŠ‚çœèµ„æºã€‚æ•°æ®ä¼šåœ¨15:30æ—¥çº¿æ›´æ–°åä¿æŒä¸€è‡´ã€‚

### Q: æ¦‚å¿µç›‘æ§æ•°æ®æ˜¾ç¤ºæ˜¨å¤©çš„ï¼Ÿ
A: æ£€æŸ¥ç›‘æ§è„šæœ¬æ˜¯å¦è¿è¡Œï¼š`ps aux | grep monitor_no_flask`ã€‚å¦‚æœªè¿è¡Œï¼Œæ‰‹åŠ¨å¯åŠ¨ã€‚

### Q: å¦‚ä½•éªŒè¯æ•°æ®ä¸€è‡´æ€§ï¼Ÿ
A: è¿è¡Œ `python scripts/test_data_consistency.py`ï¼Œæˆ–ç­‰å¾…æ¯æ—¥15:45è‡ªåŠ¨éªŒè¯ã€‚

## è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. å¼€å¯ Pull Request

## è®¸å¯è¯

MIT License

## è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æäº¤ Issue æˆ–è”ç³»ç»´æŠ¤è€…ã€‚

---

**æœ€åæ›´æ–°**: 2026-01-20
**ç‰ˆæœ¬**: v2.0
**éƒ¨ç½²è´Ÿè´£äºº**: Claude Sonnet 4.5
